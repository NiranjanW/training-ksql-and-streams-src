# Instructions

This sample is using **Gradle** (instead of Maven) to build the artefacts.

1. Make sure Kafka is running. From withing the `streams` folder run:

    ```
    $ docker-compose up -d
    ```

2. From within the **project** folder build the application:

    ```
    $ docker container run --rm \
        -v "$PWD":/home/gradle/project \
        -v "$HOME"/.gradle:/home/gradle/.gradle \
        -w /home/gradle/project \
        gradle:4.8.0-jdk8-alpine gradle build
    ```

3. From within the **project** folder run the application:

    ```
    $ docker container run --rm \
        --net streams_streams-net \
        -v $(PWD)/build/libs/map-sample-0.1.0.jar:/app.jar \
        openjdk:8-jre-alpine java -jar /app.jar
    ```

4. From within the `streams` folder create some input data:

    ```
    docker-compose exec kafka sh -c 'cat << EOF | kafka-console-producer \
        --broker-list kafka:9092 \
        --property "parse.key=true" \
        --property "key.separator=:" \
        --key-serializer=org.apache.kafka.common.serialization.StringSerializer \
        --value-serializer=org.apache.kafka.common.serialization.StringSerializer \
        --topic lines-topic
    1:"Kafka powers the Confluent Streaming Platform"
    2:"Events are stored in Kafka"
    3:"Confluent contributes to Kafka"
    EOF'
    ```

5. From within the `streams` folder double check that output was generated by your application:

    ```
    $ docker-compose exec kafka kafka-console-consumer \
        --bootstrap-server kafka:9092 \
        --key-deserializer=org.apache.kafka.common.serialization.StringDeserializer \
        --value-deserializer=org.apache.kafka.common.serialization.StringDeserializer \
        --from-beginning \
        --topic lines-lower-topic
    ```

NOTE: 

The following commands are to be executed from within the `streams` folder.

1. To list all topics in Kafka use:

    ```
    $ docker-compose exec kafka kafka-topics \
        --zookeeper zookeeper:32181 \
        --list
    ```

2. To delete a topic (e.g. the `lines-topic`) use:

    ```
    $ docker-compose exec kafka kafka-topics \
        --zookeeper zookeeper:32181 \
        --delete \
        --topic lines-topic
    ```
